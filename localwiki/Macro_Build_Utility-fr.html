<html><head><title>Macro Build Utility/fr</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link type='text/css' href='wiki.css' rel='stylesheet'></head><body><h1>Macro Build Utility/fr</h1></div>

<div id="mw-content-text" lang="fr" dir="ltr" class="mw-content-ltr"><hr/><div class="mw-parser-output"><table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tr>
<td class="ctTitle">
<h3><span class="mw-headline" id="Macro_Build_Utility"><a href="https://www.freecadweb.org/wiki/index.php?title=File:Macro_Build_Utility.png" class="image"><img alt="Macro Build Utility.png" src="32px-Macro_Build_Utility.png" width="32" height="32" srcset="/wiki/images/thumb/8/87/Macro_Build_Utility.png/48px-Macro_Build_Utility.png 1.5x, /wiki/images/8/87/Macro_Build_Utility.png 2x" /></a> Macro Build Utility</span></h3>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left">This macro provides a Build Utility to assemble multiple project files into one project file.
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven"><a href="https://www.freecadweb.org/wiki/index.php?title=User:Piffpoof" title="User:Piffpoof">Piffpoof</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven"><a href="https://www.freecadweb.org/wiki/index.php?title=Macros_recipes/fr" title="Macros recipes/fr">Recettes macros</a><br /><a href="https://www.freecadweb.org/wiki/index.php?title=How_to_install_macros/fr" title="How to install macros/fr">Comment installer une macro</a><br /><a href="https://www.freecadweb.org/wiki/index.php?title=Customize_Toolbars/fr" title="Customize Toolbars/fr">Comment ajouter une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Date derni√®re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2015-01-21
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br /><div id="toc" class="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Macro_Build_Utility"><span class="tocnumber">1</span> <span class="toctext">Macro Build Utility</span></a></li>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">2</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Installation"><span class="tocnumber">3</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Usage"><span class="tocnumber">4</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#User_Interface"><span class="tocnumber">5</span> <span class="toctext">User Interface</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Example"><span class="tocnumber">6</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Options"><span class="tocnumber">7</span> <span class="toctext">Options</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Remarks"><span class="tocnumber">8</span> <span class="toctext">Remarks</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Links"><span class="tocnumber">9</span> <span class="toctext">Links</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Script"><span class="tocnumber">10</span> <span class="toctext">Script</span></a></li>
</ul>
</div>

</td></tr>
</table>
<p><br />
</p>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>This macro is intended for use on large projects, ones involving hundreds of objects. It's use on a small single file project would be pointless and unnecessary. However on a large project with many objects and many files to be merged into the final one, it will save time, avoid the user being involved in repetitive actions, and remove human errors.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>All the code for buildUtility.FCMacro is in one macro. So installation is comprised of copying the code to the appropriate Macro directory and invoking the Build Utility from the Macro menu, the Python console or a toolbar button (the preferred method).
</p>
<ul><li> see <a href="How_to_install_macros.html" title="How to install macros">How to install macros</a> for information on how to install this macro code</li>
<li> see <a href="Customize_Toolbars.html" title="Customize Toolbars">Customize Toolbars</a> for information how to install as a button on a toolbar</li></ul>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>The Build Utility works on the same principals as the build files that are used to assemble large software system (like FreeCAD). A text editor is used to create a text file which adheres to the formats required by the Build Utility. The Build Utility then simply reads each line of the text file and performs the actions specified by that text file.
</p><p>The macro asks the user for a "build file". It then parses that build file, there are 3 legal line types:
</p>
<ul><li> lines starting with the comment character "#" which are ignored as being comments or remarks</li>
<li> lines starting with the subfile character "@" which are ignored<br /><b>Note</b>: the "@" character is for future enhancement when sub-build files will be handled</li>
<li> all other lines which may be a project file or a sub-directory</li></ul>
<p>The file extension for Build Utility file is ".FCBld". This is so file do not get mixed up with other uses and applications.
</p><p>Any file specified in the build file is assumed to have the extension ".FCStd"
If the line starts with a directory then the project file is read from that subfolder. Otherwise it is assumed the line specifies a project file. Directories within directories are supported so nesting of arbitrary depths is possible. The file specification format is the "Unix" style with different levels separated by the forward slash character "/".
</p><p>Any missing file is printed onto the Report view. Any missing directory is printed onto the Report view.
</p><p>A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
</p>
<h2><span class="mw-headline" id="User_Interface">User Interface</span></h2>
<p>There really isn't a GUI at all for this macro. The macro reads a text file that has been prepared with a text editor and produces a model in an output document. Other than clicking the button on the toolbar to start the process, there is no user interaction.
</p>
<h2><span class="mw-headline" id="Example">Example</span></h2>
<p>You are working with some other departments in your company to use FreeCAD to generate a large CAD model for an external client. To prepare for the upcoming presentation you need to integrate the models represented in the 'black' and 'blue' subsystems, the engineering department has responsibility for the 'green' and 'grey' subsystems and you have the 'metal' subsystem on your own computer. The client also uses FreeCAD and your design must integrate with their subsystems "red', and 'yellow'. The external client has told you that the Stacker Assembly is not ready for you to use so you comment it out in your build file.
</p><p>There are a lot of directory paths to type in so you enter the commands into the Build Utility text file which means you can run it with a single click on a toolbar button.
</p><p><a href="https://www.freecadweb.org/wiki/index.php?title=File:MacroBuildUtilityTreeDiagram.jpg" class="image"><img alt="MacroBuildUtilityTreeDiagram.jpg" src="500px-MacroBuildUtilityTreeDiagram.jpg" width="500" height="371" srcset="/wiki/images/thumb/3/31/MacroBuildUtilityTreeDiagram.jpg/750px-MacroBuildUtilityTreeDiagram.jpg 1.5x, /wiki/images/thumb/3/31/MacroBuildUtilityTreeDiagram.jpg/1000px-MacroBuildUtilityTreeDiagram.jpg 2x" /></a>
</p><p>The contents of the build file "buildFile.FCBld" shown below shows the file structure for the project described above.
</p>
<pre>#this is the build file for the complete assembly
#==============================
@sub-build-files - not presently implemented
# first the top-level file
metal
# now some misc files
./black/black
./blue/blue
# file does not exist
zebra 
# folder does not exist
/bear/bear
# multiple files in one sub-folder
./engineering/green
./engineering/grey
#multiple files in hierarchical folders
./externalModules/white
./externalModules/red/red
#./externalModules/red/stackerAssembly - commented out as not currently loading
./externalModules/red/orange
./externalModules/red/level3/yellow </pre>
<p>A summary of the file and how it is processed is:
</p>
<ul><li> the first two lines are treated as comments and everything following the initial character of the hash sign is ignored</li></ul>
<pre>#this is the build file for the complete assembly
#============================== </pre>
<ul><li> the third line is also ignored because it's first character is the ampersand character which is reserved for future use where command files can invoke other commend files</li></ul>
<pre>@sub-build-files - not presently implemented </pre>
<ul><li> the fifth line is the first file specification, the file is in the same directory as the build file, not in a sub-directory</li></ul>
<pre>metal </pre>
<ul><li> the seventh and eighth lines are both file specifications where the file is in a sub-directory, note that the sub-directory is of the form "./black/" where "black" is the directory name, so a file called "sheetFold.FCstd" in the directory "outsourcing" would appear "./outsourcing/sheetFold"</li></ul>
<pre>./black/black
./blue/blue </pre>
<ul><li> the nineteenth line shows a file specification which exists but is not being included in this build operation</li></ul>
<pre>#./externalModules/red/stackerAssembly - commented out as not currently loading </pre>
<ul><li> the last two lines show file specifications where the file is in more than one level of sub-directory</li></ul>
<pre>./externalModules/red/orange
./externalModules/red/level3/yellow </pre>
<h2><span class="mw-headline" id="Options">Options</span></h2>
<p>There is no GUI so there are no options. The only alternatives that exist are by using the 3 types of lines in the text file as described above.
</p>
<h2><span class="mw-headline" id="Remarks">Remarks</span></h2>
<p>To reiterate what was stated at the outset, there is no use for this macro on a small single file model. But for persons modeling a plane, locomotive, ship, building, physical plant, complex circuity there is a definitive use and advantage. By choosing the ".FCBld" file extension it is hoped a standard of sorts can be set for build files within FreeCAD. By reserving the "@" prefix character in the command file definition it is hoped that future use and (if needed) growth can be accommodated.
</p>
<h2><span class="mw-headline" id="Links">Links</span></h2>
<p>none (so far)
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<pre>#
#Build Utility
#                       v 0.0 - build from files and files in sub-folders
#
#***********************************************************************************
# routine to read in a build file and merge all specified projects
"""
This function asks the user for a "build file". It then parses that build file, there
are 3 legal line types:
- lines starting with the comment character "#" which are ignored
- lines starting with the subfile character "@" which are ignored
Note:the "@" character is for future enhancement when sub-build files 
will be handled
- all other lines which may be a project file or a subfolder (sub-directory)
If the line is a subfolder then the project file is read from that subfolder.
Otherwise it is assumed the line specifies a project file.
A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
"""
"""
Example file:
#this is a sample build file
#==============================
@sub-build-files - not presently inplemented
# first the top-level file
metal
# now some misc files
./black/black
./blue/blue
# file does not exist
zebra 
# folder does not exist
/bear/bear
# multiple files in one sub-folder
./engineering/green
./engineering/grey
#multiple files in hierarchical folders
./externalModules/white
./externalModules/red/red
#./externalModules/red/stackerAssembly - commented out as not currently loading
./externalModules/red/orange
./externalModules/red/level3/yellow
"""
# import statements
import FreeCAD
import os.path
from PySide import QtGui

# UI Class definitions

# Class definitions

# Function definitionss

# Constant definitions
buildTargetDocument = "build_target"
commentTag = "#"
subfileTag = "@"
lineFeed = "\n"
subfolder = "./"
carriageReturn = "\r"
fileSeparator = "/"
fcFileExtension      = ".FCStd"
fcFileExtensionUC  = ".FCSTD"
fcFileExtensionLen = -6

# code ***********************************************************************************
buildFilePathName=QtGui.QFileDialog.getOpenFileName()[0]
if len(buildFilePathName) &gt; 0:
# set up a new empty "build_target" document
FreeCAD.newDocument(buildTargetDocument)
FreeCAD.setActiveDocument(buildTargetDocument)
FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
guiDoc=FreeCADGui.ActiveDocument
#
lastFileSeparator = buildFilePathName.rindex(fileSeparator)
buildFilePath = buildFilePathName[: lastFileSeparator]
buildFileName = buildFilePathName[lastFileSeparator +1:]
#
buildFileContents = open(buildFilePathName,"r")
buildFileLines = buildFileContents.readlines()
buildFileContents.close()
#
for line in buildFileLines:
if line[0] == commentTag:
# line of internal comment
pass
elif line[0] == subfileTag:
# line of sub-build-file (not presently implemented)
pass
else:
# a line which should specify a FreeCAD project file
# - may be preceded by a sub-directory e.g. "./subdir309/"
# - project file may be missing file extension
#
# if line break at end of file spec then remove
if line[-1:] == lineFeed:
line = line[:-1]
if line[-1:] == carriageReturn:
line = line[:-1]
# if no FreeCAD project file extension supplied then append one
# make an uppercase comparison in case of mixed case
tempLine = fcFileExtension + line.upper()
if fcFileExtensionUC&#160;!= tempLine[fcFileExtensionLen:]:
line = line + fcFileExtension
# if there is a leading subdirectory then remove "./" from beginning
if subfolder[0:2] == line[0:2]:
line = line[2:]
projectFileSpec = str(buildFilePath) + str("/") + str(line)
if os.path.exists(projectFileSpec):
guiDoc.mergeProject(projectFileSpec)
else:
FreeCAD.Console.PrintMessage('project file "' + projectFileSpec + '" not found' + "\n")

# set view back to "build_target", it is up to user to save it (if they want)
FreeCAD.setActiveDocument(buildTargetDocument)
FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
FreeCADGui.ActiveDocument=FreeCADGui.getDocument(buildTargetDocument)
FreeCADGui.SendMsgToActiveView("ViewFit")
FreeCADGui.activeDocument().activeView().viewAxometric()
#
#OS: Mac OS X
#Word size: 64-bit
#Version: 0.14.3703 (Git)
#Branch: releases/FreeCAD-0-14
#Hash: c6edd47334a3e6f209e493773093db2b9b4f0e40
#Python version: 2.7.5
#Qt version: 4.8.6
#Coin version: 3.1.3
#SoQt version: 1.5.0
#OCC version: 6.7.0
#
#thus ends the macro... </pre>
<div style="clear:both"></div>
</div>



</div>

</div><div class="printfooter">
Online version: "<a dir="ltr" href="https://www.freecadweb.org/wiki/index.php?title=Macro_Build_Utility/fr&amp;oldid=240034">http://www.freecadweb.org/wiki/index.php?title=Macro_Build_Utility/fr&amp;oldid=240034</a>"</div>
<div id="catlinks" class="catlinks" data-mw="interface"></div><div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>

</body></html>