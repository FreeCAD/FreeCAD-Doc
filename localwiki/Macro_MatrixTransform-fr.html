<html><head><title>Macro MatrixTransform/fr</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link type='text/css' href='wiki.css' rel='stylesheet'></head><body><h1>Macro MatrixTransform/fr</h1></div>

<div id="mw-content-text" lang="fr" dir="ltr" class="mw-content-ltr"><hr/><div class="mw-parser-output"><table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tr>
<td class="ctTitle">
<h3><span class="mw-headline" id="MatrixTransform"><a href="https://www.freecadweb.org/wiki/index.php?title=File:Text-x-python.png" class="image"><img alt="Text-x-python.png" src="32px-Text-x-python.png" width="32" height="32" srcset="/wiki/images/2/2c/Text-x-python.png 1.5x" /></a> MatrixTransform</span></h3>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left">Transforme unobjet en modifiant la matrice 3x3 (parametrique)
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven"><a href="https://www.freecadweb.org/wiki/index.php?title=User:DeepSOIC" title="User:DeepSOIC">DeepSOIC</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven"><a href="https://www.freecadweb.org/wiki/index.php?title=Macros_recipes/fr" title="Macros recipes/fr">Recettes macros</a><br /><a href="https://www.freecadweb.org/wiki/index.php?title=How_to_install_macros/fr" title="How to install macros/fr">Comment installer une macro</a><br /><a href="https://www.freecadweb.org/wiki/index.php?title=Customize_Toolbars/fr" title="Customize Toolbars/fr">Comment ajouter une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Date derni√®re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2016-05-25
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br /><div id="toc" class="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#MatrixTransform"><span class="tocnumber">1</span> <span class="toctext">MatrixTransform</span></a></li>
<li class="toclevel-1 tocsection-1"><a href="#Installation:"><span class="tocnumber">2</span> <span class="toctext">Installation:</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#How_to_use:"><span class="tocnumber">3</span> <span class="toctext">How to use:</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#example_matrices"><span class="tocnumber">3.1</span> <span class="toctext">example matrices</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#No_transformation"><span class="tocnumber">3.1.1</span> <span class="toctext">No transformation</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#non-uniform_scaling"><span class="tocnumber">3.1.2</span> <span class="toctext">non-uniform scaling</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#shearing"><span class="tocnumber">3.1.3</span> <span class="toctext">shearing</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

</td></tr>
</table>
<p><br />
</p><p>Applies linear transformation to a shape, defined by a 3x3 matrix. It is possible to:
</p>
<ul><li> apply non-linear scaling to a shape</li>
<li> shear a shape</li>
<li> rotate a shape</li></ul>
<h2><span class="mw-headline" id="Installation:">Installation:</span></h2>
<p>download these two files and save them in macro directory:
</p><p><a rel="nofollow" class="external free" href="https://github.com/DeepSOIC/FreeCAD-Macros/raw/master/MatrixTransform/MatrixTransform.FCMacro">https://github.com/DeepSOIC/FreeCAD-Macros/raw/master/MatrixTransform/MatrixTransform.FCMacro</a>
</p><p><a rel="nofollow" class="external free" href="https://github.com/DeepSOIC/FreeCAD-Macros/raw/master/MatrixTransform/MatrixTransform.py">https://github.com/DeepSOIC/FreeCAD-Macros/raw/master/MatrixTransform/MatrixTransform.py</a>
</p>
<h2><span class="mw-headline" id="How_to_use:">How to use:</span></h2>
<ol><li> Select the shape to be transformed</li>
<li> In FreeCAD menu: Macro -&gt; Macros... -&gt; double-click MatrixTransform.FCMacro . A new object will be created.</li>
<li> Select the new object, and edit v1,v2,v3 properties on data tab to set the transformation matrix.</li></ol>
<p>Matrix is defined by three vectors:
</p>
<pre>          v1x   v2x   v3x                  
   M = (  v1y   v2y   v3y )                  
          v1z   v2z   v3z                  
</pre>
<p>Here, v1,v2,v3 are vectors that can be defined in properties. They correspond
to new directions of what was originally X,Y,Z axes.
</p>
<h3><span class="mw-headline" id="example_matrices">example matrices</span></h3>
<h4><span class="mw-headline" id="No_transformation">No transformation</span></h4>
<pre>   1  0  0
   0  1  0
   0  0  1
</pre>
<h4><span class="mw-headline" id="non-uniform_scaling">non-uniform scaling</span></h4>
<pre>   scaleX    0      0
      0   scaleY    0
      0      0   scaleZ
</pre>
<h4><span class="mw-headline" id="shearing">shearing</span></h4>
<p>(operation that makes regular text into italic; assuming text is in XY plane)
</p>
<pre>   1  shear  0
   0    1    0
   0    0    1
</pre>
<p>'Shear' coefficient defines the amount of shearing. 0 is no shearing. 1 makes
the text italic by 45 degrees. -1 shears in backslash-like fashion.
</p><p><br />
Warning. All geometry is converted to B-splines, even if it doesn't have to.
This can cause all sorts of trouble. Use only if absolutely necessary.
</p><p><br />
</p>
<div style="clear:both"></div>
<p><br />
MatrixTransform.py:
</p>
<pre>#***************************************************************************
#*                                                                         *
#*   Copyright (c) 2015 - Victor Titov (DeepSOIC)                          *
#*                                               &lt;vv.titov@gmail.com&gt;      *  
#*                                                                         *
#*   This program is free software; you can redistribute it and/or modify  *
#*   it under the terms of the GNU Lesser General Public License (LGPL)    *
#*   as published by the Free Software Foundation; either version 2 of     *
#*   the License, or (at your option) any later version.                   *
#*   for detail see the LICENCE text file.                                 *
#*                                                                         *
#*   This program is distributed in the hope that it will be useful,       *
#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
#*   GNU Library General Public License for more details.                  *
#*                                                                         *
#*   You should have received a copy of the GNU Library General Public     *
#*   License along with this program; if not, write to the Free Software   *
#*   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  *
#*   USA                                                                   *
#*                                                                         *
#***************************************************************************

__title__="Macro MatrixTransform"
__author__ = "DeepSOIC"
__doc__ = '''
Macro MatrixTransform.
Distorts geometry according to vector transformation defined by the matrix.

Matrix is defined by three vectors:
       v1x   v2x   v3x                  
M = (  v1y   v2y   v3y )                  
       v1z   v2z   v3z                  
Here, v1,v2,v3 are vectors that can be defined in properties. They correspond
to new directions of what was originally X,Y,Z axes.

exmaple matrices:

No transformation:
1  0  0
0  1  0
0  0  1

non-uniform scaling:
scaleX    0      0
   0   scaleY    0
   0      0   scaleZ

shearing (operation that makes regular text into italic; assuming text is in XY
plane):
1  shear  0
0    1    0
0    0    1
('shear' coefficient defines the amount of shearing. 0 is no shearing. 1 makes
the text italic by 45 degrees. -1 shears in backslash-like fashion.)


Warning. All geometry is converted to B-splines, even if it doesn't have to.
This can cause all sorts of trouble. Use only if absolutely necessary.
'''

import FreeCAD as App
if App.GuiUp:
    import FreeCADGui as Gui
import Part

def makeMatrixTransformFeature():
    '''makeMatrixTransformFeature(): makes a MatrixTransform parametric feature object. Returns the new object.'''
    obj = App.ActiveDocument.addObject("Part::FeaturePython","Transform")
    MatrixTransform(obj)
    ViewProviderMatrixTransform(obj.ViewObject)
    return obj

class MatrixTransform:
    "The FuseCompound object"
    def __init__(self,obj):
        obj.addProperty("App::PropertyLink","Base","MatrixTransform","Input shape")
        obj.addProperty("App::PropertyVector","v1","MatrixTransform","Vector for new X axis; first column of transform matrix.")
        obj.addProperty("App::PropertyVector","v2","MatrixTransform","Vector for new Y axis; second column of transform matrix.")
        obj.addProperty("App::PropertyVector","v3","MatrixTransform","Vector for new Z axis; third column of transform matrix.")
        obj.v1 = App.Vector(1,0,0)
        obj.v2 = App.Vector(1,1,0)
        obj.v3 = App.Vector(0,0,1)
        obj.Proxy = self
        

    def execute(self,obj):
        v1 = obj.v1
        v2 = obj.v2
        v3 = obj.v3
        m = App.Matrix(  v1.x, v2.x, v3.x, 0,
                         v1.y, v2.y, v3.y, 0,
                         v1.z, v2.z, v3.z, 0,
                         0,    0,    0,    1   )
        obj.Shape = obj.Base.Shape.transformGeometry(m)

class ViewProviderMatrixTransform:
    
    def __init__(self,vobj):
        vobj.Proxy = self
       
    def getIcon(self):
        return ""

    def attach(self, vobj):
        self.ViewObject = vobj
        self.Object = vobj.Object
  
    def setEdit(self,vobj,mode):
        return False
    
    def unsetEdit(self,vobj,mode):
        return

    def __getstate__(self):
        return None

    def __setstate__(self,state):
        return None

    def claimChildren(self):
        return [self.Object.Base]
        
    def onDelete(self, feature, subelements): # subelements is a tuple of strings
        try:
            self.Object.Base.ViewObject.show()
        except Exception as err:
            App.Console.PrintError("Error in onDelete: " + err.message)
        return True

def run():
    sel = Gui.Selection.getSelection()
    try:
        if len(sel)&#160;!= 1:
            raise Exception("Select a shape to transform, first! Then run this macro.")
        obj = makeMatrixTransformFeature()
        obj.Base = sel[0]
        obj.Proxy.execute(obj)
    except Exception as err:
        from PySide import QtGui
        mb = QtGui.QMessageBox()
        mb.setIcon(mb.Icon.Warning)
        mb.setText(err.message)
        mb.setWindowTitle("Macro MatrixTransform")
        mb.exec_() </pre>
<p>MatrixTransform.FCMacro:
</p>
<pre>import MatrixTransform
MatrixTransform.run() </pre>
</div>



</div>

</div><div class="printfooter">
Online version: "<a dir="ltr" href="https://www.freecadweb.org/wiki/index.php?title=Macro_MatrixTransform/fr&amp;oldid=240874">http://www.freecadweb.org/wiki/index.php?title=Macro_MatrixTransform/fr&amp;oldid=240874</a>"</div>
<div id="catlinks" class="catlinks" data-mw="interface"></div><div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>

</body></html>